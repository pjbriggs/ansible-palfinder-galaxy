# Supervisord configuration for Galaxy
# See https://wiki.galaxyproject.org/Admin/Config/Performance/Scaling#Starting_and_Stopping
[unix_http_server]
file=/tmp/supervisor.sock

[supervisord]
;logfile=/var/log/supervisor/supervisord.log  ; (main log file;default $CWD/supervisord.log)
logfile_maxbytes=50MB       ; (max main logfile bytes b4 rotation;default 50MB)
logfile_backups=10          ; (num of main logfile rotation backups;default 10)
loglevel=info               ; (log level;default info; others: debug,warn,trace)
;pidfile=/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)
nodaemon=false              ; (start in foreground if true;default false)
minfds=1024                 ; (min. avail startup file descriptors;default 1024)
minprocs=200                ; (min. avail process descriptors;default 200)
;umask=022                  ; (process file creation umask;default 022)

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[program:galaxy_uwsgi]
command         = {{ galaxy_root }}/.venv/bin/uwsgi --plugin python --ini-paste {{ galaxy_root }}/config/galaxy.ini
directory       = {{ galaxy_root }}
umask           = 022
autostart       = true
autorestart     = true
startsecs       = 10
user            = galaxy
environment     = PATH={{ galaxy_root }}/.venv:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin,PYTHON_EGG_CACHE={{ galaxy_root }}/.python-eggs,PYTHONPATH={{ galaxy_root }}/eggs/PasteDeploy-1.5.0-py2.7.egg
numprocs        = 1
stopsignal      = INT

[program:handler]
command         = {{ galaxy_root }}/.venv/bin/python ./scripts/paster.py serve config/galaxy.ini --server-name=handler%(process_num)s --pid-file={{ galaxy_root }}/handler%(process_num)s.pid --log-file={{ galaxy_root }}/handler%(process_num)s.log
directory       = {{ galaxy_root }}
process_name    = handler%(process_num)s
numprocs        = 1
umask           = 022
autostart       = true
autorestart     = true
startsecs       = 15
user            = galaxy
environment     = PYTHON_EGG_CACHE={{ galaxy_root }}/.python-eggs,SGE_ROOT=/var/lib/gridengine

[group:galaxy]
programs = handler, galaxy_uwsgi